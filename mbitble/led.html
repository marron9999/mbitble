<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>MBITBLE - LED</title>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<link  href="reset.css" type="text/css" rel="stylesheet">
<script src="mbituuid.js" type="text/javascript"></script>
<script src="mbitble.js" type="text/javascript"></script>
<link  href="mbitble.css" type="text/css" rel="stylesheet">
<style>
#matrix span {
	display:inline-block;
	width:24px;
	height:24px;
	border: 1px solid gray;
	margin-right: 6px;
}
</style>
<script>
window.onload = function() {
	let h = "";
	for(let y=0; y<5; y++) {
	for(let x=0; x<5; x++) {
		h += "<span onclick='led(this)'></span>";
	}
	h += "<br>";
	}
	E("matrix").innerHTML = h;

};
var LED = {};
connectBLE = async function () {
	initBLE();
	LOG('MBITBLE.connect("LED", LED);');
	LED = await MBITBLE.connect("LED", LED);
};
function text() {
	let v = E("text").value;
	LOG('LED.write_text("TEXT", "' + v + '");');
	LED.write_text("TEXT", v);
}
function matrix() {
	LOG('LED.write_data("MATRIX", Uint8Array(5));');
	let leds = new Uint8Array(5);
	let e = E("matrix");
	let n = 0;
	for(let y=0; y<5; y++) {
		leds[y] = 0;
		for(let x=0; x<5; x++) {
			leds[y] *= 2;
			if(e.children[n].style.background == "black") {
				leds[y] += 1;
			}
			n++;
			if(e.children[n].tagName == "BR") n++;
		}
	}
	LED.write_data("MATRIX", leds);
}
function led(e) {
	if(e.style.background == "black") {
		e.style.background = "white";
	} else {
		e.style.background = "black";
	}
}
</script>
</head>
<body>
<div id=body>
<div><button onclick="connectBLE()">Connect</button>
&nbsp;<button onclick="disconnectBLE()">Disconnect</button></div>
<hr>

<div><button onclick="text()">TEXT</button> &nbsp; ASCII char only, Max 20</div>
<div><input id=text value="hello"></div>
<div> </div>

<hr>

<div><button onclick="matrix()">MATRIX</button></div>
<div id=matrix></div>

</div>
<hr>
<div id=log></div>
</body>
</html>
